<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead Feedback System - Demo Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #F8FAFC 0%, #E2E8F0 100%);
            color: #1E293B;
            line-height: 1.6;
        }

        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px -5px rgba(30, 64, 175, 0.3);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .demo-controls {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(15, 23, 42, 0.04);
            border: 1px solid #E2E8F0;
        }

        .demo-controls h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #0F172A;
        }

        .control-group {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .demo-button {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .demo-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .demo-button.secondary {
            background: linear-gradient(135deg, #64748B 0%, #475569 100%);
        }

        .demo-button.success {
            background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%);
        }

        .demo-button.danger {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(15, 23, 42, 0.04);
            border: 1px solid #E2E8F0;
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-icon {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            color: white;
            border-radius: 12px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-title {
            font-size: 14px;
            font-weight: 600;
            color: #64748B;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #0F172A;
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 14px;
            font-weight: 500;
        }

        .stat-change.positive {
            color: #22C55E;
        }

        .stat-change.negative {
            color: #EF4444;
        }

        .data-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(15, 23, 42, 0.04);
            border: 1px solid #E2E8F0;
        }

        .section-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #0F172A;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .data-table th,
        .data-table td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #E2E8F0;
        }

        .data-table th {
            background: #F8FAFC;
            font-weight: 600;
            color: #475569;
            font-size: 14px;
        }

        .data-table td {
            font-size: 14px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-new { background: #F1F5F9; color: #475569; }
        .status-contacted { background: #EBF8FF; color: #1E40AF; }
        .status-success { background: #F0FDF4; color: #166534; }
        .status-failed { background: #FEF2F2; color: #DC2626; }

        .rating-stars {
            display: inline-flex;
            gap: 2px;
        }

        .rating-star {
            width: 16px;
            height: 16px;
            color: #F59E0B;
        }

        .rating-star.empty {
            color: #D1D5DB;
        }

        .demo-url {
            background: #F8FAFC;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            padding: 12px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            margin-top: 12px;
            word-break: break-all;
        }

        .json-viewer {
            background: #1E293B;
            color: #E2E8F0;
            border-radius: 8px;
            padding: 16px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 12px;
        }

        .key { color: #60A5FA; }
        .string { color: #34D399; }
        .number { color: #FBBF24; }
        .boolean { color: #F87171; }

        @media (max-width: 768px) {
            .dashboard {
                padding: 10px;
            }
            
            .control-group {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <header class="header">
            <h1>Insurance Lead Feedback System</h1>
            <p>Professional Demo Dashboard - Real-time Analytics & Data Collection</p>
        </header>

        <section class="demo-controls">
            <h2>Demo Controls</h2>
            <div class="control-group">
                <button class="demo-button" onclick="openFeedbackForm()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10 9H9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Open Feedback Form
                </button>
                <button class="demo-button success" onclick="seedDemoData()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L13.09 8.26L22 9L17 14.74L18.18 21.02L12 17.77L5.82 21.02L7 14.74L2 9L8.91 8.26L12 2Z" fill="currentColor"/>
                    </svg>
                    Generate Sample Data
                </button>
                <button class="demo-button secondary" onclick="refreshData()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M23 4V10H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M20.49 15C19.9828 16.8038 18.8913 18.3854 17.4039 19.4951C15.9165 20.6047 14.1201 21.1785 12.2784 21.1351C10.4367 21.0917 8.66947 20.4339 7.23205 19.2622C5.79463 18.0905 4.75873 16.4705 4.26121 14.6599C3.76369 12.8494 3.83036 10.9349 4.45294 9.16858C5.07553 7.40227 6.22055 5.87302 7.72931 4.79927C9.23807 3.72552 11.0299 3.15949 12.8716 3.18194C14.7133 3.20438 16.4914 3.81477 17.97 4.93Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M23 4L12 15L9 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Refresh Data
                </button>
                <button class="demo-button danger" onclick="clearData()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Clear All Data
                </button>
            </div>
            
            <div class="demo-url" id="demoUrl">
                Sample URL: feedback-page.html?leadId=INS-4567&brokerId=broker_123&source=email&timestamp=1702876543210
            </div>
        </section>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="stat-title">Total Feedback</div>
                </div>
                <div class="stat-value" id="totalFeedback">0</div>
                <div class="stat-change positive" id="feedbackChange">+0 this week</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L15.09 8.26L22 9L17 14.74L18.18 21.02L12 17.77L5.82 21.02L7 14.74L2 9L8.91 8.26L12 2Z" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                    </div>
                    <div class="stat-title">Average Rating</div>
                </div>
                <div class="stat-value" id="averageRating">0.0</div>
                <div class="stat-change" id="ratingChange">No change</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M9 11C11.2091 11 13 9.20914 13 7C13 4.79086 11.2091 3 9 3C6.79086 3 5 4.79086 5 7C5 9.20914 6.79086 11 9 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89317 18.7122 8.75608 18.1676 9.45768C17.623 10.1593 16.8604 10.6597 16 10.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="stat-title">Active Brokers</div>
                </div>
                <div class="stat-value" id="activeBrokers">0</div>
                <div class="stat-change positive" id="brokersChange">+0 this month</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M22 12H18L15 21L9 3L6 12H2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="stat-title">Response Time</div>
                </div>
                <div class="stat-value" id="responseTime">0s</div>
                <div class="stat-change positive" id="responseChange">15% faster</div>
            </div>
        </div>

        <section class="data-section">
            <div class="section-header">
                <h2 class="section-title">Recent Feedback Submissions</h2>
                <button class="demo-button" onclick="exportData()">Export Data</button>
            </div>
            <table class="data-table" id="feedbackTable">
                <thead>
                    <tr>
                        <th>Lead ID</th>
                        <th>Broker</th>
                        <th>Rating</th>
                        <th>Status</th>
                        <th>Issues</th>
                        <th>Submitted</th>
                    </tr>
                </thead>
                <tbody id="feedbackTableBody">
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #64748B;">
                            No feedback data available. Click "Generate Sample Data" to populate demo data.
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section class="data-section">
            <div class="section-header">
                <h2 class="section-title">System Information</h2>
            </div>
            <div class="json-viewer" id="systemInfo">
                Loading system information...
            </div>
        </section>
    </div>

    <script src="scripts/backend-simulation.js"></script>
    <script>
        let backend = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            backend = new BackendSimulation();
            loadSystemInfo();
            refreshData();
        });

        function openFeedbackForm() {
            const leadId = 'DEMO-' + Math.floor(Math.random() * 9000 + 1000);
            const brokerId = 'broker_' + Math.floor(Math.random() * 100);
            const url = `feedback-page.html?leadId=${leadId}&brokerId=${brokerId}&source=demo&timestamp=${Date.now()}`;
            
            window.open(url, '_blank');
            document.getElementById('demoUrl').textContent = 'Current Demo URL: ' + url;
        }

        function seedDemoData() {
            if (backend) {
                backend.seedDemoData();
                refreshData();
                showNotification('Demo data generated successfully!', 'success');
            }
        }

        function clearData() {
            if (confirm('Are you sure you want to clear all demo data?')) {
                if (backend) {
                    backend.clearDemoData();
                    refreshData();
                    showNotification('All data cleared successfully!', 'info');
                }
            }
        }

        function refreshData() {
            if (!backend) return;

            // Update statistics
            const report = backend.generateDemoReport();
            
            document.getElementById('totalFeedback').textContent = report.systemOverview.totalFeedback;
            document.getElementById('activeBrokers').textContent = report.systemOverview.totalBrokers;
            
            // Calculate average rating
            const avgRating = report.ratingTrends ? 
                calculateAverageRating(report.ratingTrends) : 0;
            document.getElementById('averageRating').textContent = avgRating.toFixed(1);
            
            // Calculate average response time
            const avgResponseTime = report.recentActivity.length > 0 ?
                report.recentActivity.reduce((sum, item) => sum + (item.responseTime || 0), 0) / report.recentActivity.length : 0;
            document.getElementById('responseTime').textContent = Math.round(avgResponseTime) + 's';

            // Update feedback table
            updateFeedbackTable(report.recentActivity);

            // Update system info
            updateSystemInfo(report);
        }

        function calculateAverageRating(trends) {
            let totalRatings = 0;
            let weightedSum = 0;
            
            for (let rating = 1; rating <= 5; rating++) {
                const count = trends[rating] || 0;
                totalRatings += count;
                weightedSum += rating * count;
            }
            
            return totalRatings > 0 ? weightedSum / totalRatings : 0;
        }

        function updateFeedbackTable(feedbackData) {
            const tbody = document.getElementById('feedbackTableBody');
            
            if (feedbackData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #64748B;">
                            No feedback data available. Click "Generate Sample Data" to populate demo data.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = feedbackData.slice(0, 10).map(item => `
                <tr>
                    <td><code>${item.leadId}</code></td>
                    <td>${item.brokerName || item.brokerId}</td>
                    <td>${renderStars(item.rating)}</td>
                    <td><span class="status-badge status-${getStatusClass(item.status)}">${item.status}</span></td>
                    <td>${item.issues?.join(', ') || 'None'}</td>
                    <td>${new Date(item.submittedAt).toLocaleDateString('en-NZ')}</td>
                </tr>
            `).join('');
        }

        function renderStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                const filled = i <= rating;
                stars += `<svg class="rating-star ${filled ? '' : 'empty'}" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L15.09 8.26L22 9L17 14.74L18.18 21.02L12 17.77L5.82 21.02L7 14.74L2 9L8.91 8.26L12 2Z"/>
                </svg>`;
            }
            return `<div class="rating-stars">${stars}</div>`;
        }

        function getStatusClass(status) {
            if (['new', 'contacted'].includes(status)) return 'new';
            if (['booked', 'first-meeting', 'second-meeting', 'submitted'].includes(status)) return 'contacted';
            if (status === 'issued') return 'success';
            if (status === 'failed') return 'failed';
            return 'new';
        }

        function updateSystemInfo(report) {
            const systemInfo = document.getElementById('systemInfo');
            const info = {
                timestamp: new Date().toISOString(),
                database: {
                    leads: report.systemOverview.totalLeads,
                    brokers: report.systemOverview.totalBrokers,
                    feedback: report.systemOverview.totalFeedback
                },
                analytics: {
                    topBrokers: report.topPerformingBrokers?.slice(0, 3),
                    commonIssues: report.issueAnalysis?.slice(0, 5),
                    ratingDistribution: report.ratingTrends
                },
                performance: {
                    systemUptime: report.systemOverview.systemUptime,
                    lastUpdated: report.systemOverview.lastUpdated
                }
            };
            
            systemInfo.innerHTML = syntaxHighlight(JSON.stringify(info, null, 2));
        }

        function loadSystemInfo() {
            const systemInfo = {
                version: '1.0.0',
                environment: 'demo',
                features: [
                    'Real-time data collection',
                    'Advanced analytics',
                    'Mobile-optimized interface',
                    'Automated broker notifications',
                    'Comprehensive reporting'
                ],
                apiEndpoints: [
                    'POST /api/v1/feedback',
                    'GET /api/v1/leads/{id}',
                    'GET /api/v1/brokers/{id}',
                    'GET /api/v1/analytics'
                ]
            };
            
            document.getElementById('systemInfo').innerHTML = syntaxHighlight(JSON.stringify(systemInfo, null, 2));
        }

        function syntaxHighlight(json) {
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'key';
                    } else {
                        cls = 'string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'boolean';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        function exportData() {
            if (!backend) return;
            
            const data = backend.exportData('json');
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `feedback-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully!', 'success');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#22C55E' : type === 'error' ? '#EF4444' : '#3B82F6'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                transition: all 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Auto-refresh data every 30 seconds
        setInterval(refreshData, 30000);
    </script>
</body>
</html>